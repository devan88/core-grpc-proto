name: "Build & Push Nuget"
description: "Runs dockerfile to output version"
inputs:
  working_directory:
    description: "Working directory containing project"
    required: true
  github_token:
    description: "Github token to push nuget package"
    required: true
  next_version:
    description: "Next version"
    required: true
  nuget_source:
    description: "Nuget source"
    required: true

runs:
  using: composite
  steps:
    - name: checkout
      uses: actions/checkout@v3
    - name: Build Dockerfile
      run: |
        docker build -f ${{ inputs.working_directory }}/Dockerfile . --build-arg VERSION=${{ inputs.next_version }} --build-arg PAT=${{ inputs.github_token }} -t core-grpc-csharp-proto:${{ inputs.next_version }}
      shell: bash
    - name: Run Dockerfile & Push
      run: |
        docker run --rm --name push-packages core-grpc-csharp-proto:${{ inputs.next_version }} --source ${{ inputs.nuget_source }} --api-key ${{ inputs.github_token }}
      shell: bash